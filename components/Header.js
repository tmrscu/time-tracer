import Link from "next/link";
import {
  Box,
  Stack,
  Collapse,
  Flex,
  Text,
  Button,
  useDisclosure,
  Menu,
  MenuButton,
  MenuItem,
  MenuList,
  Avatar,
  Divider,
  useMediaQuery,
} from "@chakra-ui/react";
import { HamburgerIcon } from "@chakra-ui/icons";
import { supabaseClient } from "../utils/client";
import { useAuth } from "../context/Auth";
import NavMenu from "./NavMenu";
import MobileNavMenu from "./MobileNavMenu";

const Header = (props) => {
  // Handle state and function to toggle mobile menu
  const { isOpen, onOpen, onClose } = useDisclosure();
  const handleToggle = () => (isOpen ? onClose() : onOpen());

  // Get the user context and set the name variable
  const { user } = useAuth();
  const name = `${user?.user_metadata?.first_name} ${user?.user_metadata?.last_name}`;

  // Check if size of the screen is desktop size
  const [isDesktop] = useMediaQuery("(min-width: 768px)");

  // Supabase logout function
  const logout = () => {
    supabaseClient.auth.signOut();
  };

  return (
    <Flex
      as="nav"
      align="center"
      justify="space-between"
      wrap="wrap"
      px={12}
      py={6}
      bg="brand.primary"
      color="white"
      {...props}
    >
      <Flex align="center" maxW={48} mr={5} ml={{ base: "-30px", md: "0px" }}>
        <Link href={"/"}>
          <a>
            <Logo />
          </a>
        </Link>
      </Flex>

      <Box
        cursor={"pointer"}
        position="absolute"
        top={9}
        right={6}
        display={{ base: "block", md: "none" }}
        onClick={handleToggle}
      >
        <HamburgerIcon boxSize={6} />
      </Box>
      {!isDesktop && (
        <MobileNavMenu
          isOpen={isOpen}
          onClose={onClose}
          user={user}
          logout={logout}
        />
      )}

      <NavMenu />
      <Box
        display={{ base: isOpen ? "block" : "none", md: "block" }}
        mt={{ base: 4, md: 0 }}
      >
        <Box display={{ base: "none", md: "block" }}>
          <Menu>
            <MenuButton>
              <Avatar
                name={!user?.user_metadata?.first_name ? "" : name}
                as={Button}
              />
            </MenuButton>
            <MenuList color={"brand.text"}>
              <Text ml={3} mb={2} fontSize="sm" color={"gray.500"} border>
                Logged in as:{" "}
                <Text
                  as="span"
                  color={"gray.700"}
                >{`${user?.user_metadata?.first_name} ${user?.user_metadata?.last_name}`}</Text>
              </Text>
              <Divider></Divider>
              <MenuItem _focus={{ bg: "purple.100" }} onClick={logout}>
                Logout
              </MenuItem>
              <Link href={"/profile"}>
                <a>
                  <MenuItem _focus={{ bg: "purple.100" }}>
                    Profile Settings
                  </MenuItem>
                </a>
              </Link>
            </MenuList>
          </Menu>
        </Box>
      </Box>
    </Flex>
  );
};

// Logo for the navbar
const Logo = () => (
  <svg
    width="100%"
    height="46"
    viewBox="0 0 216 46"
    fill="none"
    xmlns="http://www.w3.org/2000/svg"
  >
    <path
      fillRule="evenodd"
      clipRule="evenodd"
      d="M42.1674 32.0423C43.0734 32.2843 44.0158 31.7424 44.2578 30.8364L45.2924 26.9703C45.5366 26.0642 44.9925 25.1218 44.0865 24.8798C42.1802 24.2693 40.7965 22.6158 40.5352 20.6303C40.2739 18.6447 41.1821 16.6892 42.8656 15.6054C43.6774 15.1363 43.9601 14.0868 43.4911 13.2728L41.4905 9.80726C41.0214 8.99334 39.9719 8.71275 39.158 9.18182C37.3781 10.0986 35.2298 9.90578 33.6426 8.68919C32.0555 7.47045 31.3122 5.44422 31.7385 3.48866C31.9805 2.58264 31.4386 1.64021 30.5304 1.39817L26.6665 0.361496C25.7604 0.119462 24.818 0.661362 24.576 1.56738C23.9655 3.47367 22.312 4.85734 20.3264 5.11865C18.343 5.37996 16.3854 4.47179 15.3016 2.78826C14.8325 1.97434 13.783 1.69376 12.969 2.16283L9.50345 4.16336C8.69167 4.63244 8.40894 5.68197 8.87801 6.49374C9.79474 8.27366 9.60412 10.422 8.38538 12.0113C7.16664 13.5984 5.1404 14.3417 3.18485 13.9154C2.27883 13.6712 1.3364 14.2153 1.09436 15.1213L0.0576847 18.9874C-0.184349 19.8934 0.35755 20.8359 1.26571 21.0779C3.172 21.6884 4.55567 23.344 4.81698 25.3274C5.07829 27.3108 4.17012 29.2685 2.48659 30.3523C1.67267 30.8214 1.39209 31.8709 1.86116 32.6827L3.86169 36.1483C4.33077 36.9622 5.3803 37.2428 6.19207 36.7737C7.97199 35.857 10.1203 36.0476 11.7096 37.2664C13.2967 38.4851 14.04 40.5113 13.6137 42.4669C13.3717 43.3729 13.9136 44.3153 14.8196 44.5574L18.6858 45.5941C19.5918 45.8361 20.5342 45.2942 20.7762 44.386C21.3867 42.4797 23.0424 41.0961 25.0258 40.8348C27.0092 40.5734 28.9669 41.4816 30.0485 43.1651C30.5176 43.9791 31.5671 44.2597 32.381 43.7906L35.8466 41.79C36.6605 41.321 36.9411 40.2714 36.4721 39.4597C35.5553 37.6797 35.7481 35.5314 36.9647 33.9421C38.1834 32.355 40.2097 31.6118 42.1652 32.038L42.1674 32.0423ZM9.82473 19.5379L9.83972 19.4801L9.85472 19.4222L9.87185 19.3644L9.88899 19.3066L9.90612 19.2487L9.92326 19.1909L9.94039 19.1331L9.95753 19.0752L9.97466 19.0174L9.9918 18.9596L10.0089 18.9017L10.0282 18.8461L10.0475 18.7904L10.0668 18.7347L10.086 18.679L10.1053 18.6233L10.1246 18.5676L10.146 18.5119L10.1653 18.4562L10.1846 18.4005L10.206 18.3449L10.2274 18.2892L10.2488 18.2335L10.2702 18.1778C10.2852 18.1414 10.2981 18.105 10.3131 18.0686L10.3345 18.0129L10.3559 17.9593L10.3773 17.9058L10.3988 17.8522L10.4202 17.7987C10.4352 17.7623 10.4502 17.7258 10.4673 17.6916L10.4909 17.638C10.5059 17.6016 10.523 17.5673 10.538 17.5309L10.5615 17.4774L10.5851 17.4238L10.6108 17.3703C10.6258 17.336 10.6429 17.2996 10.6601 17.2653L10.6858 17.2139L10.7115 17.1625L10.7372 17.1111L10.7629 17.0597L10.7886 17.0083L10.8143 16.9569L10.84 16.9055L10.8678 16.8541L10.8935 16.8027C10.9214 16.7513 10.9471 16.6999 10.9749 16.6506C10.9942 16.6163 11.0113 16.5821 11.0306 16.5499L11.0585 16.4985L11.0863 16.4493C11.1056 16.415 11.1249 16.3829 11.142 16.3486L11.172 16.2993L11.202 16.2501L11.232 16.2008L11.2619 16.1516L11.2919 16.1023C11.8038 15.2562 12.4036 14.4766 13.0761 13.7783C14.8218 11.9641 17.0536 10.6747 19.4975 10.0707C20.44 9.83724 21.4145 9.70659 22.4041 9.68731C23.6292 9.66375 24.878 9.80726 26.1203 10.1414C27.3626 10.4734 28.5171 10.9724 29.5666 11.6064C30.4126 12.1184 31.1923 12.7181 31.8905 13.3906C33.7047 15.1363 34.9941 17.3681 35.5982 19.8121C35.8316 20.7545 35.9623 21.729 35.9816 22.7186V22.7764V22.8343V22.8921V22.9499V23.0078V23.1234V23.1813L35.9794 23.2391L35.9773 23.3547C35.9751 23.4126 35.973 23.4704 35.9709 23.5282L35.9687 23.5861L35.9666 23.6439L35.9644 23.7017L35.9601 23.7596L35.9559 23.8174L35.9516 23.8752L35.9473 23.9331L35.943 23.9909L35.9387 24.0487C35.9344 24.0873 35.9323 24.1258 35.928 24.1644L35.9216 24.2222L35.9152 24.28L35.9087 24.3379C35.9045 24.3764 35.9002 24.415 35.8959 24.4535L35.8895 24.5114L35.883 24.5692L35.8745 24.627L35.868 24.6849L35.8595 24.7427L35.8509 24.8005L35.8423 24.8584L35.8338 24.9162C35.8273 24.9547 35.8209 24.9933 35.8166 25.0319L35.8081 25.0897L35.7995 25.1475L35.7888 25.2053L35.7781 25.2632L35.7674 25.321L35.7567 25.3788L35.746 25.4367L35.7352 25.4945L35.7245 25.5523L35.7138 25.6102L35.701 25.668L35.6881 25.7258L35.6753 25.7837L35.6624 25.8415L35.6496 25.8993L35.6367 25.9572L35.6239 26.015L35.611 26.0728L35.596 26.1306L35.581 26.1885L35.566 26.2463L35.551 26.3041L35.536 26.362L35.5211 26.4198L35.5061 26.4776L35.4911 26.5355L35.4761 26.5933L35.4589 26.6511L35.4418 26.709L35.4247 26.7668L35.4075 26.8246L35.3904 26.8825L35.3733 26.9403L35.3561 26.996L35.3368 27.0538L35.3197 27.1095L35.3004 27.1652L35.2812 27.2209L35.2619 27.2787L35.2426 27.3344L35.2233 27.3901L35.2041 27.4458L35.1848 27.5015L35.1634 27.5571L35.1419 27.6128L35.1205 27.6685L35.0991 27.7242L35.0777 27.7799C35.0627 27.8163 35.0498 27.8527 35.0348 27.8891L35.0134 27.9427L34.992 27.9984L34.9706 28.0541L34.9492 28.1076L34.9278 28.1612L34.9042 28.2147L34.8806 28.2683L34.8571 28.3218C34.8421 28.3561 34.8271 28.3925 34.8099 28.4289L34.7864 28.4824L34.7628 28.536L34.7393 28.5895C34.7221 28.6238 34.705 28.6602 34.69 28.6945L34.6643 28.748L34.6386 28.7994L34.6129 28.8509L34.5872 28.9023L34.5615 28.9537L34.5358 29.0051L34.5101 29.0565L34.4822 29.1079L34.4565 29.1593C34.4308 29.2107 34.403 29.2621 34.3751 29.3135C34.3559 29.3478 34.3387 29.382 34.3195 29.4142L34.2916 29.4634L34.2638 29.5127C34.2445 29.547 34.2252 29.5791 34.2081 29.6134L34.1781 29.6626L34.1481 29.7119L34.1181 29.7612L34.0881 29.8104L34.0581 29.8597C33.5462 30.7057 32.9465 31.4832 32.2739 32.1836C30.5283 33.9978 28.2964 35.2873 25.8525 35.8913C24.9101 36.1247 23.9377 36.2554 22.9481 36.2747C21.723 36.3004 20.4742 36.1547 19.2319 35.8206C17.9896 35.4864 16.8352 34.9895 15.7856 34.3555C14.9396 33.8436 14.1599 33.2439 13.4617 32.5713C11.6475 30.8257 10.3581 28.5938 9.75405 26.1499C9.52058 25.2075 9.38992 24.2329 9.37065 23.2434V23.1855V23.1277V23.0699V22.9542C9.37065 22.9157 9.37065 22.8771 9.37065 22.8386V22.7807L9.37279 22.7229C9.37279 22.6843 9.37279 22.6458 9.37493 22.6072C9.37707 22.5494 9.37922 22.4916 9.38136 22.4337L9.3835 22.3759L9.38564 22.3181L9.38993 22.2602L9.39207 22.2024L9.39635 22.1446L9.40063 22.0867L9.40492 22.0289L9.4092 21.9711L9.41349 21.9133C9.41777 21.8747 9.41991 21.8361 9.4242 21.7976L9.42848 21.7398L9.43491 21.6819L9.44133 21.6241C9.44561 21.5855 9.4499 21.547 9.45418 21.5084L9.46061 21.4506C9.46489 21.412 9.46918 21.3735 9.4756 21.3349L9.48203 21.2771L9.49059 21.2193L9.49916 21.1614L9.50773 21.1036L9.5163 21.0458C9.52272 21.0072 9.52701 20.9687 9.53343 20.9301L9.542 20.8723L9.55057 20.8145L9.56128 20.7566L9.57199 20.6988L9.5827 20.641L9.59341 20.5831L9.60411 20.5253L9.61482 20.4675L9.62553 20.4096L9.63624 20.3518L9.64909 20.294L9.66195 20.2361L9.6748 20.1783L9.68765 20.1205L9.7005 20.0627L9.71335 20.0048L9.72834 19.947L9.7412 19.8892L9.75619 19.8313L9.77118 19.7735L9.78618 19.7157L9.80117 19.6578L9.81616 19.6L9.83116 19.5422L9.82473 19.5379Z"
      fill="white"
    />
    <path
      fillRule="evenodd"
      clipRule="evenodd"
      d="M29.6915 16.8569L30.8674 15.681C29.548 14.4365 27.9116 13.492 26.0374 12.9886C20.008 11.3736 13.8093 14.9506 12.1922 20.9822C12.0423 21.5433 11.9352 22.1067 11.873 22.6678C13.4816 16.7091 19.6139 13.1771 25.5769 14.775C27.1276 15.1905 28.5134 15.9123 29.6893 16.8569H29.6915Z"
      fill="#D9D9D9"
    />
    <path
      fillRule="evenodd"
      clipRule="evenodd"
      d="M24.9471 24.8933C26.6606 23.9958 29.1302 21.2478 32.358 16.6491C27.5109 19.2708 24.5187 21.3741 23.3749 22.9613C22.1905 24.6084 23.1393 25.84 24.9471 24.8933Z"
      fill="#D9D9D9"
    />
    <path
      d="M56.2311 20.9323H51.6055V18.2065H64.202V20.9323H59.5764V32.6615H56.2311V20.9323ZM65.5328 21.5518H68.7542V32.6615H65.5328V21.5518ZM67.1435 20.003C66.5516 20.003 66.0697 19.831 65.698 19.4868C65.3263 19.1426 65.1405 18.7159 65.1405 18.2065C65.1405 17.6971 65.3263 17.2704 65.698 16.9262C66.0697 16.582 66.5516 16.4099 67.1435 16.4099C67.7355 16.4099 68.2173 16.5751 68.589 16.9055C68.9607 17.2359 69.1466 17.6489 69.1466 18.1445C69.1466 18.6814 68.9607 19.1289 68.589 19.4868C68.2173 19.831 67.7355 20.003 67.1435 20.003ZM85.9718 21.3866C87.3623 21.3866 88.4636 21.7996 89.2758 22.6256C90.1018 23.4378 90.5148 24.6631 90.5148 26.3013V32.6615H87.2934V26.7969C87.2934 25.9158 87.1076 25.2619 86.7359 24.8351C86.3779 24.3946 85.8617 24.1743 85.1871 24.1743C84.43 24.1743 83.8311 24.4221 83.3906 24.9177C82.95 25.3996 82.7298 26.1223 82.7298 27.086V32.6615H79.5084V26.7969C79.5084 25.0485 78.8063 24.1743 77.4021 24.1743C76.6587 24.1743 76.0667 24.4221 75.6262 24.9177C75.1856 25.3996 74.9654 26.1223 74.9654 27.086V32.6615H71.744V21.5518H74.8208V22.8321C75.2338 22.364 75.7363 22.0061 76.3283 21.7583C76.934 21.5105 77.5948 21.3866 78.3107 21.3866C79.0954 21.3866 79.8044 21.5449 80.4376 21.8615C81.0709 22.1644 81.5803 22.6118 81.9657 23.2038C82.42 22.6256 82.9913 22.1782 83.6797 21.8615C84.3818 21.5449 85.1458 21.3866 85.9718 21.3866ZM104.406 27.1479C104.406 27.1892 104.385 27.4783 104.344 28.0152H95.9393C96.0908 28.7036 96.4487 29.2474 97.0131 29.6466C97.5776 30.0458 98.2797 30.2454 99.1194 30.2454C99.6976 30.2454 100.207 30.1628 100.648 29.9976C101.102 29.8187 101.522 29.5433 101.907 29.1716L103.621 31.0301C102.575 32.2278 101.047 32.8267 99.0368 32.8267C97.7841 32.8267 96.6758 32.5858 95.7122 32.1039C94.7485 31.6083 94.0051 30.9269 93.482 30.0596C92.9588 29.1923 92.6973 28.208 92.6973 27.1066C92.6973 26.0191 92.952 25.0416 93.4613 24.1743C93.9845 23.2933 94.6934 22.6118 95.5883 22.13C96.4969 21.6344 97.5087 21.3866 98.6238 21.3866C99.7114 21.3866 100.696 21.6206 101.577 22.0887C102.458 22.5568 103.146 23.2313 103.642 24.1124C104.151 24.9797 104.406 25.9915 104.406 27.1479ZM98.6445 23.8233C97.9148 23.8233 97.3022 24.0298 96.8066 24.4428C96.311 24.8558 96.0082 25.4202 95.898 26.1361H101.37C101.26 25.434 100.957 24.8764 100.462 24.4634C99.9661 24.0367 99.3603 23.8233 98.6445 23.8233ZM115.62 20.9323H110.994V18.2065H123.591V20.9323H118.965V32.6615H115.62V20.9323ZM127.999 23.0179C128.384 22.481 128.9 22.0749 129.547 21.7996C130.208 21.5243 130.965 21.3866 131.819 21.3866V24.3602C131.461 24.3327 131.22 24.3189 131.096 24.3189C130.174 24.3189 129.451 24.5805 128.928 25.1036C128.405 25.613 128.143 26.3839 128.143 27.4164V32.6615H124.922V21.5518H127.999V23.0179ZM138.155 21.3866C139.876 21.3866 141.197 21.7996 142.12 22.6256C143.042 23.4378 143.503 24.6699 143.503 26.3219V32.6615H140.488V31.2779C139.883 32.3104 138.754 32.8267 137.102 32.8267C136.248 32.8267 135.505 32.6821 134.872 32.393C134.252 32.1039 133.777 31.7047 133.447 31.1953C133.116 30.686 132.951 30.1078 132.951 29.4607C132.951 28.4282 133.337 27.616 134.107 27.024C134.892 26.4321 136.097 26.1361 137.721 26.1361H140.282C140.282 25.434 140.068 24.8971 139.642 24.5254C139.215 24.1399 138.575 23.9472 137.721 23.9472C137.129 23.9472 136.544 24.0436 135.966 24.2363C135.402 24.4153 134.92 24.6631 134.52 24.9797L133.364 22.7288C133.97 22.3021 134.693 21.9717 135.532 21.7376C136.386 21.5036 137.26 21.3866 138.155 21.3866ZM137.907 30.6584C138.458 30.6584 138.946 30.5345 139.373 30.2867C139.8 30.0252 140.103 29.6466 140.282 29.151V28.0152H138.072C136.751 28.0152 136.09 28.4489 136.09 29.3162C136.09 29.7292 136.248 30.0596 136.565 30.3074C136.895 30.5414 137.343 30.6584 137.907 30.6584ZM151.909 32.8267C150.725 32.8267 149.658 32.5858 148.708 32.1039C147.772 31.6083 147.035 30.9269 146.498 30.0596C145.975 29.1923 145.714 28.208 145.714 27.1066C145.714 26.0053 145.975 25.021 146.498 24.1537C147.035 23.2864 147.772 22.6118 148.708 22.13C149.658 21.6344 150.725 21.3866 151.909 21.3866C153.079 21.3866 154.098 21.6344 154.965 22.13C155.846 22.6118 156.486 23.307 156.885 24.2156L154.387 25.5579C153.809 24.5392 152.976 24.0298 151.888 24.0298C151.048 24.0298 150.353 24.3051 149.802 24.8558C149.252 25.4065 148.976 26.1567 148.976 27.1066C148.976 28.0565 149.252 28.8068 149.802 29.3575C150.353 29.9082 151.048 30.1835 151.888 30.1835C152.989 30.1835 153.822 29.6741 154.387 28.6554L156.885 30.0183C156.486 30.8994 155.846 31.5877 154.965 32.0833C154.098 32.5789 153.079 32.8267 151.909 32.8267ZM169.482 27.1479C169.482 27.1892 169.461 27.4783 169.42 28.0152H161.015C161.166 28.7036 161.524 29.2474 162.089 29.6466C162.653 30.0458 163.355 30.2454 164.195 30.2454C164.773 30.2454 165.283 30.1628 165.723 29.9976C166.178 29.8187 166.597 29.5433 166.983 29.1716L168.697 31.0301C167.651 32.2278 166.122 32.8267 164.113 32.8267C162.86 32.8267 161.752 32.5858 160.788 32.1039C159.824 31.6083 159.081 30.9269 158.558 30.0596C158.035 29.1923 157.773 28.208 157.773 27.1066C157.773 26.0191 158.028 25.0416 158.537 24.1743C159.06 23.2933 159.769 22.6118 160.664 22.13C161.573 21.6344 162.584 21.3866 163.7 21.3866C164.787 21.3866 165.771 21.6206 166.653 22.0887C167.534 22.5568 168.222 23.2313 168.718 24.1124C169.227 24.9797 169.482 25.9915 169.482 27.1479ZM163.72 23.8233C162.991 23.8233 162.378 24.0298 161.882 24.4428C161.387 24.8558 161.084 25.4202 160.974 26.1361H166.446C166.336 25.434 166.033 24.8764 165.537 24.4634C165.042 24.0367 164.436 23.8233 163.72 23.8233ZM174.703 23.0179C175.089 22.481 175.605 22.0749 176.252 21.7996C176.913 21.5243 177.67 21.3866 178.523 21.3866V24.3602C178.165 24.3327 177.925 24.3189 177.801 24.3189C176.878 24.3189 176.155 24.5805 175.632 25.1036C175.109 25.613 174.848 26.3839 174.848 27.4164V32.6615H171.626V21.5518H174.703V23.0179Z"
      fill="white"
    />
  </svg>
);

export default Header;
